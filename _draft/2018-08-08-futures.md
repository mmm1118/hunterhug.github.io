---
layout: post
title: "期货和永续合约游戏规则"
date: 2018-8-08
author: nil
desc: "入了坑..."
categories: ["生活"]
tags: ["生活"]
permalink: "/life/futures.html"
---

# 一.期货

衍生产品市场在金融领域越来越重要，区别于金融的股票，债券，基金等。衍生产品是指由某种更为基本的变量派生出来的产品。

最简单的衍生产品是远期合约，他是在将来某一指定时间以约定价格买入或卖出某一种东西的合约，远期合约一般是金融机构和金融机构在场外进行交易。
同意在将来某一时刻以约定价格买入资产的一方称为多头方，卖出的则为空头方。期货合约，类似于远期合约，不过是在交易所进行交易，交易所指定了一套规则保证交易双方履行合约承诺。 

利用期货，有三种类型的交易者：对冲，投机和套利者。

交易方式：双方约定在某一时期，在某一地点，以某一价格进行货物交割，在交易所里，你只需买入和卖出，并在最后平仓即可。
平仓，即是反方向操作。比如我买了两手土豆，如果到交割日还不平掉，那么你必须到现场交割，这时你可以选择平仓，即卖出这两手土豆。（一手相当于一个合约，一个合约可能规定50顿小土豆）

为了规避风险，保证交易的正常进行，有保证金机制，每天交易所会进行清算。比如下方：

![](/picture/futures/f1.jpg)

你约定在九月份买入两份黄金期货合约，一份合约100盎司黄金，即约定在九月份买入200盎司黄金。
这时买入的黄金价格是1盎司1450元。这时，你不必真的支付1450*200=290000元，
你只需支付12000元的保证金即可，相当于20倍杠杆，你可以用极少的钱暂时买到很多的黄金，
不像股票需要全价，这就是期货的魅力，造成你很有钱的假象。约定九月份以1450元1盎司买入黄金，
因为黄金的价格会经常涨跌，所以交易所为了方便结算有清算机制。
比如第一天黄金突然跌到1441元，相当于你已经亏了9元/盎司，闭市时从你的保证金扣除，现在你的保证金12000-200*9剩10200元。
如果黄金涨了，你的保证金也会增加，你就赚了。

期货有这样的特点，所以有人基于不同的目的而进行期货买卖，以下为几个故事来解释：

农场主的对冲：

土豆农场主在十二月份会收成1000万吨土豆，现在期货市场有十二月的土豆期货合约，一手1000吨，1吨大概500元。
农场主怕到十二月，土豆1吨不会卖到500元，恐怕会降价到300元。
抱着这种恐惧，为了降低风险，他在期货市场做了一万手的空头，即在期货市场卖出了他1000万吨的土豆。
到了十二月份的时候，土豆如果涨了，涨到600元，那么农场主在期货市场亏了，保证金不断地被吃，但是现实世界赚了，
所以实现了对冲。而如果土豆跌了，现实世界亏了，但期货市场赚钱，保证金不断地补回来。

土豆搬砖工套利：

农场主怎么能相信期货交易市场的土豆价格会反应现实世界的价格呢？
期货价格和即价价格中间有差距，这种叫基差，但最终会趋于一致，因为有了搬砖工。
不同交易所的期货价格也会不一样，但会趋于一致。土豆搬砖工，怎么搬砖的呢。
现实世界中，快到交割时土豆1吨500元，可是期货世界1吨550元，那么土豆搬砖工会拼命在现实世界囤货，
然后在期货市场拼命做空头，那可是足足1吨赚了50元。
再换个角度，在交易市场A和B，A的土豆期货价格为500元/吨，B的550元/吨，那么搬砖工可以拼命地在A做多头，在B做空头，
因为有了搬砖工，所以A的500元会一直上升(买的人多)，B的550元会一直下降(卖的人多)。所以套利套到最后无利可套。

富二代的投机：

二代很有钱，他用买股票的方法买期货，他相信我只要买了，等着，价格上升我就赚了，仅此而已。


# 永续合约

永续合约（ perpetual swap）是什么呢？

从谷歌，百度检索，只得到一个基本信息： bitmex CEO和COO一起设计的，当时为了参加新加坡的一个比赛。

永续合约类似期货， 不会到期也不会结算，即不会被交割，这个游戏会一直进行下去。

随着比特币虚拟数字货币的火热，永续合约期货交易市场就出现了，
比如比特币，你可以在交易市场买入100个比特币，不需要全额支付100*7000=700000美元的钱，
同样只需极少保证金，如果比特币涨跌，你要不断地补充保证金，不然你就会被爆仓，也就是被动平仓，
你就损失了你的保证金。永续合约的设计比较复杂，有一种叫强托管的系统，而且系统维持了一个基金账户。
就是如果你的保证金不足了，在真正的期货市场，你会被动在反方向平仓，你可能不会损失你全部的保证金，
因为当你买入期货时，期货市场价格跌了，你的保证金会一直被扣，直到保证金在维持保证金之下，反手平仓并不一定损失全部保证金，
但在永续合约，你的保证金会全被吃了，弥补涨跌那部分剩下的会归入基金。

基金的作用就是规避平台风险，交易平台只想赚手续费，剩下的涨跌导致的亏还是赚都不想参与，所以有了基金。
保证金不够了，那系统对你爆仓，平你的仓，保证金没收归入基金，但是如果保证金还不够弥补损失，那么从基金里面进行抵消。
但是，如果基金不够扣了，那系统会接管所有仓位，自动减仓系统启动，自动为相反方向的用户进行操作，
也就是拿别人的钱来补充基金。具体的操作是什么样的呢？特别复杂。

## 游戏规则

以`BitMEX`为例子，永续合约也称永续掉期合约：

1.仓位标记：永续掉期合约使用`合理价格标记`方法。 `标记价格`决定了`未实现盈亏`以及`强平价格`。

BitMEX 采用独特设计的`合理价格标记`系统，以避免在高杠杆产品上发生不必要的强制平仓。 
如果没有这个系统，那么标记价格可能会由于市场被操纵或是缺乏流动性而与`价格指数`发生不必要的偏差，从而导致不必要的强制平仓。
此系统将标记价格设置为合理价格而非最新交易价格，由此避免不必要的强平。

所有的自动减仓合约都使用合理价格标记方法。 此外请注意，此方法只影响强平价格以及未实现盈亏，它并不影响已实现盈亏。（注意：这意味着当你的委托执行后，你可能立即会看到正的或负的未实现盈亏。 发生这种情况的原因是合理价格与成交价格的略微偏差。 这是正常现象，并不意味着你损失了资金，但一定要留意你的强平价格，避免过早地被强制平仓）

对于掉期合约，其合理价格等于`标的指数价格加上随时间递减的资金费用基差`。

```
资金费用基差率 = 资金费率 *  (至下一个缴付资金费用的时间 / 资金费用时间间隔)
合理价格       = 指数价格 * (1 + 资金费用基差率)
```

怎么解释呢，这里有三个价格，一个最新交易价格，一个是指数价格，一个是标记价格（合理价格），
最新交易价格就是目前最新订单成交的价格(现交易所)，指数价格是从其他交易所获取的价格(其他交易所)，标记价格则是一个参考，

就是当你做多或者做空时，标记价格会和你的保证金一起影响你的强平价格，一旦被强，保证金就没了！
为保持仓位，投资者必须持有仓位价值一定比例的保证金，也称之为维持保证金。通过增加额外保证金、调整杠杆滑块可以调整强平价格。


2.起始和维持保证金：这些关键的保证金水平决定了可以使用多大的杠杆，以及在什么价格会触发强制平仓。


3.资金费用：买方和卖方之间每隔 8 小时定期支付费用。 如果费率为正，多仓将支付 而 空仓将获得 资金费率，如果费率为负，则相反。 - 请注意，您只有在资金时间戳时持有仓位，你才需要支付或收取资金费用。

资金费用每 8 小时产生一次，分别在北京时间 4:00 、12:00 和 20:00 。只有您在这些时间点持有仓位，您才需要收取或支付资金费用。
如果您在收费时间之前平仓，那么您就不需要收取或支付资金费用。

您支付或收到的资金计算如下：

```
资金费用 = 仓位价值 * 资金费率
```

您的仓位价值与杠杆率无关。 例如，如果您持有 100 个 XBTUSD 合约，则将按照这些合约的名义价值收取/收取资金，
而不是基于您为该仓位分配了多少保证金。

```
XBTUSD 合约明细
合约价值 = 1 USD
保证金 = 比特币 (XBT)
标的指数 = XBT BitMEX 指数
计价利率指数 = BitMEX 的 USD 借贷利率 (.USDBON)
基础利率指数 = BitMEX 的 XBT 借贷利率 (.XBTBON)
资金费用时间戳 = 北京时间 12:00, 北京时间 08:00 以及北京时间 04:00
```

以下说明资金费率收取：

第一天，UTC 10:00（北京时间 18:00）

一名交易员在 750 美元的价格买入 15,000 张 XBTUSD 合约。

```
仓位的比特币价值 = 15,000 张合约 * 1 USD * 1/750 = 20 XBT
```

第一天，UTC 12:00（北京时间 20:00）

交易员在资金时间戳UTC时间12:00交换了资金费用。 他支付的金额按以下方式确定：

目前，XBTUSD 现货价格是 750 美元。

```
计价利率指数 = 每天 1.00% 
基础利率指数 = 每天 0.25%

资金费率 = (1.00% - 0.25%) / 3 = 0.25%
资金费用 = 仓位价值 * 资金费率 = 20 XBT * 0.25% = 0.05 XBT
```

资金费用是正数，意味着持有多仓的交易员需要支付费用，而持有空仓的对手方收取 0.05 XBT 的费用。

第一天，UTC 18:00（北京时间第二天 02:00）

XBTUSD 合约涨到 800 美元。 该交易员通过卖出 15,000 张 XBTUSD 合约平仓。 他在下一个资金时间戳北京时间 04:00 之前完成此操作，所以不需要支付资金金额。

该交易员从 XBTUSD 价格的上涨中赚取了 1.25 XBT 的利润：

```
盈亏 = 15,000 * 1 USD * (1/750-1/800) = 1.25 XBT
```

该交易员支付了 0.05 XBT 的资金费用，因此交易的总利润是 1.2 XBT (1.25 XBT-0.05 XBT)。

资金费率示例:

资金费率的计算公式：

```
利率 (I) = (计价利率指数 - 基础利率指数) / 资金费用时间间隔 
溢价指数 (P) = (Max(0, 深度加权买价 - 标记价格) - Max(0, 标记价格 - 深度加权卖价)) / 现货价格 
资金费率 (F) = 溢价指数 (P) + clamp(利率 (I) - 溢价指数 (P), 0.05%, -0.05%)
以下是资金费率（F）随着利率（I）和溢价指数（P）而变化的例子。

利率 (I)	溢价指数 §	资金费率 (F)
0.03%	0.00%	0.03%
0.03%	0.06%	0.03%
0.03%	0.15%	0.10%
0.03%	-0.05%	0.00%
0.03%	-0.10%	-0.05%
0.10%	0.06%	0.10%
0.10%	0.15%	0.10%
0.10%	-0.05%	0.00%
0.10%	-0.10%	-0.05%
0.20%	0.10%	0.15%
0.30%	0.10%	0.15%
0.45%	0.10%	0.15%
```

只有一句话，低买高卖，高杠杆高风险，一旦被曝血本无归。

更多参考：[https://www.bitmex.com/app/pnlGuide](https://www.bitmex.com/app/pnlGuide)